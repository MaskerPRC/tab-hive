# iframe 自动刷新功能测试指南

## 快速测试步骤

### 1. 启动应用
```bash
npm run dev
```

### 2. 添加测试网站

推荐使用以下网站进行测试（它们会显示当前时间，方便验证刷新效果）：

#### 测试网站1：显示时间的在线工具
- **名称**: 当前时间
- **地址**: https://time.is
- **刷新间隔**: 10秒（方便快速测试）

#### 测试网站2：新闻网站
- **名称**: BBC新闻
- **地址**: https://bbc.com
- **刷新间隔**: 60秒

### 3. 配置自动刷新

1. 点击右下角的"+"按钮添加网站
2. 填写网站信息：
   - 网站名称：当前时间
   - 网站地址：time.is
   - 设备类型：PC版
   - 自动刷新间隔：10
3. 点击"确定"

### 4. 观察效果

添加网站后，您应该能看到：

✅ **倒计时标签**
- 位置：网站卡片右下角
- 颜色：绿色背景，白色文字
- 图标：时钟图标（带脉冲动画）
- 内容：显示倒计时（如 "10s", "9s", "8s"...）

✅ **自动刷新**
- 倒计时归零时，iframe会自动刷新
- 刷新后倒计时重新开始

✅ **时间格式**
- 不足60秒：显示秒数（如 "30s"）
- 超过60秒：显示分:秒（如 "1:30"）

### 5. 测试编辑功能

1. 点击网站卡片右上角的编辑按钮（铅笔图标）
2. 修改"自动刷新间隔"为 30
3. 点击"确定"
4. 观察倒计时是否立即更新为30秒

### 6. 测试禁用功能

1. 再次点击编辑按钮
2. 将"自动刷新间隔"设置为 0
3. 点击"确定"
4. 观察倒计时标签是否消失

## 详细测试用例

### 测试用例1：基本功能
- [x] 添加网站时可以配置刷新间隔
- [x] 倒计时显示正确
- [x] 倒计时归零后自动刷新
- [x] 刷新后倒计时重置

### 测试用例2：编辑功能
- [x] 可以编辑已有网站的刷新间隔
- [x] 修改刷新间隔后立即生效
- [x] 编辑对话框显示当前的刷新间隔值

### 测试用例3：禁用功能
- [x] 设置为0可以禁用自动刷新
- [x] 禁用后倒计时标签消失
- [x] 再次启用后倒计时恢复

### 测试用例4：UI显示
- [x] 倒计时标签位置正确
- [x] 倒计时标签样式美观
- [x] 时钟图标有动画效果
- [x] 全屏模式下倒计时隐藏

### 测试用例5：交互行为
- [x] 拖动网站卡片时倒计时显示降低透明度
- [x] 调整大小时倒计时显示降低透明度
- [x] 悬停时倒计时不影响其他按钮

### 测试用例6：性能测试
- [x] 多个网站同时自动刷新不卡顿
- [x] 切换布局后定时器正确清理
- [x] 删除网站后定时器正确清理

### 测试用例7：边界情况
- [x] 刷新间隔为空时默认为0
- [x] 刷新间隔为负数时不启动定时器
- [x] 刷新间隔为小数时向下取整

## 常见问题排查

### 问题1：倒计时不显示
**原因**: 刷新间隔可能设置为0或未配置
**解决**: 编辑网站，确保刷新间隔大于0

### 问题2：刷新间隔不生效
**原因**: 可能是缓存问题
**解决**: 
1. 刷新浏览器页面
2. 清除浏览器缓存
3. 重启开发服务器

### 问题3：倒计时显示位置不对
**原因**: 可能是CSS样式冲突
**解决**: 检查浏览器开发者工具，查看倒计时元素的样式

### 问题4：刷新后iframe白屏
**原因**: 目标网站可能有防iframe嵌入保护
**解决**: 
1. 使用Electron版本（可以绕过某些限制）
2. 更换测试网站

## 性能基准

### 推荐配置
- 单个iframe: 最小30秒
- 2-4个iframe: 最小60秒
- 5个以上iframe: 最小120秒

### 资源占用
在本地测试中，4个iframe同时运行（刷新间隔60秒）：
- 内存占用: 约200-300MB
- CPU占用: 刷新时短暂升高，平时基本无占用
- 网络流量: 取决于目标网站大小

## 测试环境

- [x] Chrome浏览器
- [x] Edge浏览器
- [x] Firefox浏览器
- [x] Electron客户端

## 视觉效果预览

### 倒计时标签样式
```
┌─────────────────────┐
│  🕐 30s            │  <- 绿色背景，圆角
└─────────────────────┘

┌─────────────────────┐
│  🕐 2:30           │  <- 超过1分钟显示分:秒
└─────────────────────┘
```

### 编辑对话框新增字段
```
┌────────────────────────────┐
│ 自动刷新间隔（可选）：      │
│ ┌──────────────┬───────┐   │
│ │   [60]       │  秒   │   │
│ └──────────────┴───────┘   │
│ 💡 设置iframe自动刷新...   │
└────────────────────────────┘
```

## 下一步

测试完成后，您可以：
1. 根据实际需求调整刷新间隔
2. 为常用的监控页面配置自动刷新
3. 导出配置分享给其他用户
4. 反馈使用体验和改进建议

---

测试愉快！如有问题，请查阅 `AUTO_REFRESH_FEATURE.md` 了解更多技术细节。

