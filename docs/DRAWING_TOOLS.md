# 绘画工具功能说明

## 概述

在现有画笔绘制功能的基础上，新增了文字输入和图片粘贴功能。所有绘制内容都在UI的绘画层，不会影响网页层。

## 功能特性

### 1. 画笔工具（原有功能增强）
- **激活方式**：点击画笔图标，然后选择"画笔工具"按钮
- **使用方法**：在画布上拖动鼠标进行自由绘制
- **设置选项**：
  - 颜色选择
  - 粗细调节（1-20px）
- **特点**：使用 perfect-freehand 库实现平滑的手绘效果

### 2. 文字工具（新增）
- **激活方式**：点击画笔图标进入绘制模式，然后选择"文字工具"（T图标）
- **使用方法**：
  1. 在画布上点击要添加文字的位置
  2. 在弹出的输入框中输入文字内容
  3. 点击"确定"保存，或按 Ctrl+Enter 快速保存
  4. 点击"取消"或按 Esc 键取消输入
- **特点**：
  - 支持多行文本输入
  - 文字颜色会继承当前选择的绘制颜色
  - 字体大小：24px（默认）

### 3. 图片工具（新增）
- **激活方式**：点击画笔图标进入绘制模式，然后选择"图片工具"（图片图标）
- **使用方法**：
  1. 在画布上点击要添加图片的位置
  2. 弹出图片上传对话框后，有两种方式添加图片：
     - **粘贴方式**：按 Ctrl+V 粘贴剪贴板中的图片
     - **上传方式**：点击"选择图片"按钮，从本地选择图片文件
  3. 图片会自动缩放到合适大小（最大400px）
- **支持格式**：所有常见图片格式（jpg, png, gif, webp等）
- **特点**：
  - 自动保持图片宽高比
  - 自动限制最大尺寸，避免占用过大空间

## 工具切换

在绘制模式下，可以随时在三种工具之间切换：
- 画笔工具图标：铅笔样式
- 文字工具图标：字母T样式  
- 图片工具图标：图片框样式

当前选中的工具会以橙色高亮显示。

## 通用操作

### 清除绘制
点击垃圾桶图标可以清除所有绘制内容（包括画笔、文字和图片）。

### 绘制设置
点击设置图标（齿轮图标）可以调整：
- 绘制颜色（仅影响画笔和文字）
- 绘制粗细（仅影响画笔）

### 退出绘制模式
再次点击画笔图标即可退出绘制模式。所有绘制内容会被保存。

## 技术实现

### 数据结构
绘制数据统一存储在 `savedDrawings` 数组中，每个元素根据类型包含不同字段：

```javascript
// 画笔路径
{
  type: 'path',
  d: 'SVG路径数据',
  color: '颜色',
  width: '粗细'
}

// 文字
{
  type: 'text',
  x: x坐标,
  y: y坐标,
  content: '文字内容',
  fontSize: 字体大小,
  color: '颜色'
}

// 图片
{
  type: 'image',
  x: x坐标,
  y: y坐标,
  data: 'base64图片数据',
  width: 宽度,
  height: 高度
}
```

### 关键文件
- `src/composables/useDrawing.js` - 绘制功能核心逻辑
- `src/components/GridView.vue` - 主界面，包含绘制层和输入框
- `src/components/CanvasControls.vue` - 工具栏控制按钮

### 渲染层次
所有绘制内容都在SVG层渲染，位于网页卡片之上（z-index: 100），确保：
- 不会被网页内容遮挡
- 不会影响网页交互
- 独立于网页层，可以随意绘制

## 快捷键

- **Ctrl+Enter**：在文字输入模式下快速保存
- **Esc**：取消当前输入（文字或图片）
- **Ctrl+V**：在图片工具激活时粘贴图片

## 注意事项

1. 绘制内容会保存在布局数据中，切换布局时保留
2. 图片以base64格式存储，大图片可能会增加存储大小
3. 所有绘制操作都可以通过"清除绘制"一次性清空
4. 文字输入框支持调整大小（拖动右下角）
5. 图片会自动缩放，保持原始宽高比

