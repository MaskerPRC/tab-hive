# 工作流自动化功能 MVP 测试指南

## 📋 功能概述

本MVP版本实现了类n8n的节点化工作流系统，支持：

### 核心特性
1. **网页数据映射**：从网页元素响应式提取数据
2. **网页交互控制**：自动化点击、输入等操作
3. **Flow节点**：数据处理和流程控制
4. **Web Control节点**：专门的网页交互执行节点
5. **可视化编辑**：拖拽式节点编辑器

### MVP功能范围
- ✅ 数据映射：文本内容提取
- ✅ 交互映射：点击、文本输入
- ✅ 连接关系：数据映射（虚线）、执行流（实线）
- ✅ 执行引擎：阻塞式顺序执行

## 🧪 测试场景：Base64编码网站

### 场景描述
使用 https://www.base64encode.org/ 网站测试工作流功能：
1. 在输入框输入文本
2. 点击编码按钮
3. 提取编码结果

### 步骤说明

#### 1. 打开网站
1. 启动应用（`npm run dev` 或 Electron版）
2. 添加网站：https://www.base64encode.org/
3. 等待网页加载完成

#### 2. 打开工作流编辑器
1. 点击网站卡片右上角的"..."按钮
2. 选择"自动化工作流"选项
3. 进入工作流编辑器

#### 3. 配置网页元素映射

**步骤 3.1：选择输入框**
1. 点击左侧工具面板的"🎯 选择元素"按钮
2. 在网页上选择输入框元素（textarea#input）
3. 在弹出的配置对话框中：
   - 元素名称：输入框
   - 点击"+ 添加交互映射"
   - 类型：⌨️ 输入文本
   - 端口名称：输入内容
   - 点击"保存配置"

**步骤 3.2：选择编码按钮**
1. 再次点击"选择元素"
2. 选择"ENCODE"按钮元素
3. 配置：
   - 元素名称：编码按钮
   - 点击"+ 添加交互映射"
   - 类型：👆 点击
   - 端口名称：点击编码
   - 点击"保存配置"

**步骤 3.3：选择结果区域**
1. 再次点击"选择元素"
2. 选择结果显示区域（textarea#output）
3. 配置：
   - 元素名称：结果区域
   - 点击"+ 添加数据映射"
   - 类型：📝 文本内容
   - 端口名称：编码结果
   - 点击"保存配置"

#### 4. 创建工作流节点

**步骤 4.1：添加Flow节点**
1. 点击左侧"添加节点" → "🔄 Flow节点"
2. 拖动节点到合适位置
3. 双击节点标题，改名为"数据处理"

**步骤 4.2：添加Web Control节点**
1. 点击左侧"添加节点" → "⚡ 网页控制"
2. 拖动节点到Flow节点右侧
3. 改名为"执行编码"

**步骤 4.3：添加第二个Flow节点**
1. 再次添加Flow节点
2. 拖动到Web Control节点右侧
3. 改名为"读取结果"

#### 5. 连接节点

**连接说明：**
- **实线**：执行流（从Flow → Flow → Web Control → Flow）
- **虚线**：数据映射（从网页数据端口 → Flow）

**步骤 5.1：连接执行流**
1. 从"数据处理"的输出端口 → 拖到"执行编码"的输入端口
2. 从"执行编码"的输出端口 → 拖到"读取结果"的输入端口

**步骤 5.2：连接数据映射（可选）**
1. 从网页节点的"编码结果"数据端口 → 拖到"读取结果"节点
   （虚线，表示数据引用关系）

**步骤 5.3：连接交互控制**
1. 在"执行编码"节点右侧，找到交互控制点
2. 拖动到网页节点的"输入内容"交互端口
3. 再拖动到网页节点的"点击编码"交互端口

#### 6. 执行测试
1. 点击顶部的"▶️ 测试运行"按钮
2. 观察执行日志区域
3. 查看网页是否：
   - 输入框被填入测试文本
   - 编码按钮被点击
   - 结果区域显示编码后的内容

#### 7. 保存工作流
1. 点击"💾 保存"按钮
2. 工作流将保存到 localStorage

## 📊 节点类型说明

### 1. 网页节点 (🌐)
- **功能**：代表一个网页，包含数据映射点和交互映射点
- **数据端口（○）**：响应式提供数据，不触发执行
- **交互端口（●）**：接收控制信号，执行交互操作

### 2. Flow节点 (🔄)
- **功能**：数据处理和流程控制
- **输入端口（◀）**：接收执行流，自增
- **输出端口（▶）**：传递执行流，自增
- **数据引用**：通过虚线连接读取网页数据

### 3. Web Control节点 (⚡)
- **功能**：执行网页交互操作
- **输入端口（◀）**：接收执行流
- **交互控制**：连接到网页的交互端口
- **输出端口（▶）**：
  - 第一个输出（📊）：固定返回交互结果数据
  - 其他输出：执行流继续

## 🔍 常见问题

### Q1: 元素选择器找不到元素？
**A**: 
- 确保网页已完全加载
- 检查选择器是否正确（在控制台测试 `document.querySelector(selector)`）
- 某些动态网站可能需要等待

### Q2: 执行时报错"元素不存在"？
**A**: 
- 网页可能已刷新，元素重新渲染
- 尝试使用更稳定的选择器（ID > Class > TagName）
- 检查是否在iframe中

### Q3: 连接线无法连接？
**A**: 
- MVP版本连接规则：
  - 数据端口（○）只能连到Flow的数据输入
  - 执行流只能：Flow输出 → Flow/WebControl输入
  - 交互控制只能：WebControl → 网页交互端口

### Q4: 如何查看执行日志？
**A**: 
- 底部会显示执行日志面板
- 日志包含：执行节点、数据提取、交互执行等信息
- 可通过浏览器控制台查看更详细日志

## 🚀 下一步计划

MVP之后的功能扩展：

### Phase 2
- [ ] 更多数据映射类型（属性、样式、innerHTML等）
- [ ] 更多交互类型（hover、拖动、长按等）
- [ ] 条件判断节点
- [ ] 循环节点
- [ ] 数据转换函数

### Phase 3
- [ ] 变量系统
- [ ] 定时触发
- [ ] API调用节点
- [ ] 通知节点
- [ ] 工作流模板

### Phase 4
- [ ] 子工作流
- [ ] 错误处理
- [ ] 调试工具
- [ ] 性能优化

## 💡 实用技巧

### 1. 快速测试单个节点
在执行引擎中添加断点，逐步调试

### 2. 复用选择器
同一个选择器可配置多个数据映射和交互映射

### 3. 查看网页数据
可以先只连接数据映射，查看提取的数据是否正确

### 4. 执行顺序
执行流是阻塞式的，一个节点完成才执行下一个

### 5. 保存和加载
工作流自动保存到localStorage，刷新页面后会恢复

## 📝 反馈和建议

在使用过程中遇到任何问题或有改进建议，欢迎反馈！

---

**版本**: MVP 1.0  
**日期**: 2025-12-13  
**状态**: ✅ 核心功能已实现

