# iframe 自动刷新功能说明

## 功能概述

为每个iframe添加了定时自动刷新功能，用户可以为每个网站独立配置刷新间隔。

## 实现内容

### 1. 数据模型更新

在网站数据模型中添加了 `autoRefreshInterval` 字段（单位：秒）：

- **文件**: `src/composables/useWebsiteManager.js`
- **默认值**: 0（表示不自动刷新）
- **有效范围**: 0 或正整数

### 2. 用户界面

#### 编辑对话框
- **文件**: `src/components/WebsiteEditDialog.vue`
- **新增字段**: "自动刷新间隔（可选）"
- **输入类型**: 数字输入框，单位为秒
- **提示信息**:
  - 设置为 0 或留空表示不自动刷新
  - 建议最小值：30秒
  - 适用场景：实时监控、数据大屏等需要定期更新的页面

#### 倒计时显示
- **文件**: `src/components/WebsiteCard.vue`
- **位置**: 右下角绿色圆角标签
- **显示内容**: 距离下次刷新的剩余时间
- **图标**: 时钟图标，带有脉冲动画效果
- **时间格式**:
  - 不足1分钟：显示秒数（如 "30s"）
  - 超过1分钟：显示分:秒（如 "2:30"）

### 3. 自动刷新逻辑

#### useAutoRefresh Composable
- **文件**: `src/composables/useAutoRefresh.js`
- **核心功能**:
  - 自动监听刷新间隔配置的变化
  - 每秒更新一次倒计时
  - 倒计时结束时自动触发刷新
  - 刷新后重置倒计时
  - 组件卸载时自动清理定时器

- **提供的方法**:
  - `startTimer(interval)`: 启动定时器
  - `resetTimer()`: 重置定时器（从头开始计时）
  - `pauseTimer()`: 暂停定时器
  - `clearTimer()`: 清除定时器

- **返回的状态**:
  - `remainingTime`: 剩余时间（秒）
  - `timerId`: 定时器ID

### 4. 集成方式

在 `WebsiteCard` 组件中：
1. 导入 `useAutoRefresh` composable
2. 传入网站数据和刷新回调函数
3. 当倒计时结束时，触发 `refresh` 事件
4. 在模板中显示倒计时标签

## 使用方法

### 为网站配置自动刷新

1. 点击网站卡片右上角的编辑按钮（铅笔图标）
2. 在编辑对话框中找到"自动刷新间隔（可选）"字段
3. 输入刷新间隔秒数（例如：60 表示每分钟刷新一次）
4. 点击"确定"保存设置

### 查看刷新倒计时

- 配置刷新间隔后，网站卡片右下角会显示一个绿色的倒计时标签
- 标签显示距离下次刷新的剩余时间
- 时钟图标会有轻微的脉冲动画效果

### 禁用自动刷新

1. 编辑网站配置
2. 将"自动刷新间隔"设置为 0 或清空
3. 保存后倒计时标签会自动消失

## 技术特性

### 性能优化
- 使用 `setInterval` 实现精确的秒级倒计时
- 自动清理定时器，防止内存泄漏
- 全屏模式下自动隐藏倒计时显示

### 用户体验
- 倒计时实时更新，用户可清楚知道下次刷新时间
- 拖动或调整大小时，倒计时显示降低透明度
- 刷新间隔配置变化时，立即生效

### 兼容性
- 完全兼容现有的手动刷新功能
- 不影响全屏模式下的刷新行为
- 与网站的其他配置（设备类型、目标选择器等）互不干扰

## 适用场景

1. **实时监控**: 监控面板、日志查看等需要定期更新的页面
2. **数据大屏**: 数据可视化大屏，定期刷新数据
3. **新闻资讯**: 新闻网站、社交媒体信息流
4. **在线文档**: 协作文档、实时编辑的内容
5. **股票行情**: 股票、加密货币等行情页面

## 注意事项

1. 建议刷新间隔不少于30秒，避免频繁刷新影响性能和网络流量
2. 某些网站可能有防刷新机制，过于频繁的刷新可能导致访问受限
3. 自动刷新会重新加载整个iframe，当前的交互状态会丢失
4. 对于需要保持登录状态的网站，频繁刷新可能导致会话超时

## 文件清单

### 新增文件
- `src/composables/useAutoRefresh.js` - 自动刷新核心逻辑

### 修改文件
- `src/components/WebsiteEditDialog.vue` - 添加刷新间隔配置界面
- `src/components/WebsiteCard.vue` - 集成自动刷新功能和倒计时显示
- `src/components/GridView.vue` - 更新网站编辑逻辑
- `src/composables/useWebsiteManager.js` - 支持 autoRefreshInterval 字段

## 后续优化建议

1. **智能刷新**: 当页面不可见（标签页切换）时暂停刷新，节省资源
2. **刷新统计**: 记录刷新次数和时间，方便用户了解使用情况
3. **批量配置**: 支持一次性为多个网站设置相同的刷新间隔
4. **预设方案**: 提供常用的刷新间隔预设（30秒、1分钟、5分钟等）
5. **条件刷新**: 仅在特定条件下刷新（如检测到内容变化）

